


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.3.2">
    
    
      
        <title>Code - Correlated Counts</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-a-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Correlated Counts" class="md-header-nav__button md-logo" aria-label="Correlated Counts">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Correlated Counts
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Code
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Correlated Counts" class="md-nav__button md-logo" aria-label="Correlated Counts">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Correlated Counts
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../methods/" title="Methods" class="md-nav__link">
      Methods
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Code
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Code" class="md-nav__link md-nav__link--active">
      Code
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specifying-the-model" class="md-nav__link">
    Specifying the Model
  </a>
  
    <nav class="md-nav" aria-label="Specifying the Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spline-specification" class="md-nav__link">
    Spline Specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-specification" class="md-nav__link">
    Example Specification
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fitting-the-model" class="md-nav__link">
    Fitting the Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-predictions" class="md-nav__link">
    Creating Predictions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#easy-model-launching" class="md-nav__link">
    Easy Model Launching
  </a>
  
    <nav class="md-nav" aria-label="Easy Model Launching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-data" class="md-nav__link">
    Bootstrap Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../updates/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specifying-the-model" class="md-nav__link">
    Specifying the Model
  </a>
  
    <nav class="md-nav" aria-label="Specifying the Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spline-specification" class="md-nav__link">
    Spline Specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-specification" class="md-nav__link">
    Example Specification
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fitting-the-model" class="md-nav__link">
    Fitting the Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-predictions" class="md-nav__link">
    Creating Predictions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#easy-model-launching" class="md-nav__link">
    Easy Model Launching
  </a>
  
    <nav class="md-nav" aria-label="Easy Model Launching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-data" class="md-nav__link">
    Bootstrap Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="running-a-model">Running a Model</h1>
<p>The core model is an object called <code>ccount.core.CorrelatedModel</code>. Each of the types of models you can fit are explained in the <a href="../models/">models</a> documentation.
If you are new to using this code base, please read the following sections about <a href="#specifying-the-model">model specification</a>,
<a href="#fitting-the-model">fitting the model</a>, and <a href="#creating-predictions">creating predictions</a>.</p>
<p>We have recently added a <code>ModelRun</code> class that combines all of the steps in the aforementioned sections to limit the amount
of code that you need to write. It also allows you to use the data bootstrap method to produce confidence intervals for your predictions. See <a href="#easy-model-launching">here</a> for documentation.</p>
<h2 id="specifying-the-model">Specifying the Model</h2>
<p>To specify a model, make sure that all variables that you need are contained within one data frame, including covariates, random effects, offsets, and weights. The outcome variables should be wide, but all other variables should be long, e.g. have one column for deaths and another column for cases, rather than one column with deaths and cases stacked on top of each other. All of these variables need to be filled in for every entry (i.e. there can be no missing values -- if you want to predict for somewhere with missing outcome information, you can do that later with the <a href="#creating-predictions">function</a> that makes predictions).</p>
<p>The class that you can use to initialize a model is <code>ccount.run.ModelRun</code>.
This class makes it easy to fit the model and to predict for a new data frame. It takes the following arguments:</p>
<ul>
<li><code>model_type</code>: <code>(str)</code> The name of the model type to be fit. The list of names are in <a href="../models/">models</a>.</li>
<li><code>df</code>: <code>(pd.DataFrame)</code> A data frame that contains all of your variables.</li>
<li><code>outcome_variables</code>: <code>(List[str])</code> A list of the names of the outcome variables.</li>
<li><code>fixed_effects</code>: <code>(List[List[List[str] or None]])</code> Nested lists of the names of fixed effects to put on each of the parameters and outcomes. See <a href="../models/#parametrizing-a-model">here</a> for details. If you do <strong>not</strong> want to put any covariates on a parameter-outcome combination, pass <code>None</code> instead of <code>List[str]</code>. <em>Note: Intercepts are automatically added for each parameter-outcome. Do not add another intercept.</em></li>
<li><code>random_effect</code>: <code>(str)</code> Name of the variable that specifies the grouping of the random effect.</li>
<li><code>spline</code>: <code>(List[List[List[dict] or None]])</code> Nested lists of dictionaries that gives the spline specification</li>
<li><code>offset</code>: <code>List[str]</code> (optional) List of variable names to use as an offset for each parameter. Must be of the length of the number of parameters in each model, <strong>and in the correct order</strong>. See <a href="../models/#model-choices">here</a> for the number and order of parameters for each model type. To include an offset on only one parameter, pass a list of the variable name and <code>None</code>, in the correct order corresponding to your model type.</li>
<li><code>weight</code>: <code>(str)</code> (optional) Name of the variable that specifies the weight to place on each observation.</li>
<li><code>**kwargs</code>: Additional arguments<ul>
<li><code>normalize_X</code>: <code>(bool)</code> Whether or not to scale the covariates by their mean and standard deviation. By default, <code>normalize_X = True</code>. The resulting parameters are transformed after fitting so that they can be interpreted in the original space as the covariates.</li>
<li><code>add_intercepts</code>: <code>(bool)</code> Whether or not to add intercepts for all parameter-outcomes. By default, <code>add_intercepts = True</code>.</li>
</ul>
</li>
</ul>
<h4 id="spline-specification">Spline Specification</h4>
<p>Fitting a spline requires additional information. For each spline that you want to add, you pass a dictionary rather than a string (like you do for fixed effects).
The dictionary must have the following keys:</p>
<ul>
<li><code>name</code>: <code>(str)</code> variable name in your dataset for the spline</li>
<li><code>knots_type</code>: <code>(str)</code> one of <code>"frequency"</code> (put the knots at equal quantiles of the data) or <code>"domain"</code> (put the knots at equal spacings over the domain of the variable)</li>
<li><code>knots_num</code>: <code>(int)</code> number of knots for the spline</li>
<li><code>degree</code>: <code>(int)</code> degree of differentiation for the spline (e.g. degree of 3 is a cubic spline, most common for this application)</li>
<li><code>r_linear</code>: <code>(bool)</code> enforce linear function (rather than a potentially degree &gt; 1 spline) at the tails of your data on the <em>right</em></li>
<li><code>l_linear</code>: <code>(bool)</code> enforce linear function (rather than a potentially degree &gt; 1 spline) at the tails of your data on the <em>left</em></li>
</ul>
<h3 id="example-specification">Example Specification</h3>
<p>Consider a pandas data frame, <code>df</code>, that has the following columns: <code>deaths</code>, <code>cases</code>, <code>median_income</code>, <code>population</code>, <code>country</code>, <code>age</code>. In my example below, I will fit a Zero-Inflated Poisson model (described <a href="../models/#zero-inflated-poisson-model">here</a>) with the following:</p>
<p><em>Outcomes</em></p>
<ul>
<li>predict both deaths due to and cases of a disease, where deaths and cases are correlated with one another (2-dimensional outcome)</li>
</ul>
<p><em>Fixed Effects</em></p>
<ul>
<li>median income as a predictor for the mean of deaths</li>
<li>age as a predictor for the mean of cases</li>
<li>no predictors for the probability of a structural zero</li>
</ul>
<p><em>Splines</em>
- a spline over calendar year with 3 degrees of freedom (cubic), and 3 knots (two at the min and max of the variable, one at the median), no linearity in tails
- only applied to the mean, but applied to both cases and deaths</p>
<p>Let's specify the spline here, and in the example we will apply the spline specification to the mean function for both outcomes.</p>
<div class="codehilite"><pre><span></span><code><span class="err">spline_specs = {</span>
<span class="err">    &#39;name&#39;: &#39;year&#39;,</span>
<span class="err">    &#39;knots_type&#39;: &#39;frequency&#39;,</span>
<span class="err">    &#39;knots_num&#39;: 3,</span>
<span class="err">    &#39;degree&#39;: 3,</span>
<span class="err">    &#39;r_linear&#39;: False,</span>
<span class="err">    &#39;l_linear&#39;: False</span>
<span class="err">}</span>
</code></pre></div>


<p><em>Random Effect</em></p>
<ul>
<li>random effect grouping by country, so that all data points within the same country will have the same 2-dimensional realization that correlates their deaths with their cases</li>
</ul>
<p><em>Offset</em></p>
<ul>
<li>population as the "offset" for the mean, or the denominator that deaths and cases came from</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">ccount.run</span> <span class="kn">import</span> <span class="n">convert_df_to_model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">convert_df_to_model</span><span class="p">(</span>
    <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;zero_inflated_poisson&#39;</span><span class="p">,</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">outcome_variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;deaths&#39;</span><span class="p">,</span> <span class="s1">&#39;cases&#39;</span><span class="p">],</span>
    <span class="n">fixed_effects</span><span class="o">=</span><span class="p">[[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]]],</span>
    <span class="n">random_effect</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">],</span>
    <span class="n">spline</span><span class="o">=</span><span class="p">[[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
        <span class="p">[[</span><span class="n">spline_specs</span><span class="p">],</span> <span class="p">[</span><span class="n">spline_specs</span><span class="p">]]</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>


<h2 id="fitting-the-model">Fitting the Model</h2>
<p>Once you have the model object, returned by the function <code>model = convert_df_to_model(...)</code>, we can estimate the parameters. The class method <code>ccount.core.CorrelatedModel.optimize_params</code> does the optimization work.</p>
<p>From our example above, to fit the model, we simply run:</p>
<div class="codehilite"><pre><span></span><code><span class="err">model.optimize_params(max_iters=100, max_beta_iters=10, max_U_iters=10, rel_tol=1e-4)</span>
</code></pre></div>


<p>The parameters that are being optimized are the fixed effects and random effects. The optimization happens iteratively,
and you may not need to completely optimize the fixed and random effects in each overall iteration. To control this process, you 
may pass in any integer for <code>max_iters</code>, <code>max_beta_iters</code>, and <code>max_U_iters</code>. You can also
include a relative tolerance for the total error in the fixed and random effects with the argument <code>rel_tol</code>, and the 
program will terminate if it reaches <code>rel_tol</code> before completing <code>max_iters</code> iterations. We recommend the defaults above for all
of these arguments.</p>
<p>The parameter estimates, including the <script type="math/tex">\beta</script> fixed effects, the <script type="math/tex">U</script> random effects, and the correlation between the outcomes given by <script type="math/tex">D</script> (each described in <a href="../methods/">methods</a>) are all available in the <code>summarize</code> class method for <code>ccount.core.CorrelatedModel</code>. In our example above, to get a printed summary of the estimates (both transformed and un-transformed based on the link functions described in <a href="../models/#model-choices">the model choices</a>), run the following:</p>
<div class="codehilite"><pre><span></span><code><span class="err">model.summarize(file=...)</span>
</code></pre></div>


<p>If you want to save the model summary to a file so that you can access it later, pass <code>file=...</code> and it will re-route the output to whatever file name (must have a <code>.txt</code> extension) that you pass.
If you do not pass a file, i.e. <code>file=None</code>, then it will return the summary in your session.</p>
<h2 id="creating-predictions">Creating Predictions</h2>
<p>In order to get the fitted values of deaths and cases, you can use the function <code>ccount.run.get_predictions_from_df</code>. It takes the same arguments as <code>convert_df_to_model</code>, except that in place of <code>model_type</code>, it needs a <code>ccount.core.CorrelatedModel</code> object, and it does not need the outcome variables. For our example above, this looks like</p>
<p><code>predictions</code> is a 2-dimensional array that is the length of the data frame <code>some_df</code> along one axis and the outcome predictions along the other (i.e. predictions for deaths and cases).</p>
<p>The <code>fixed_effects</code>, <code>random_effect</code>, <code>offset</code> (if applicable), and <code>weight</code> (if applicable) arguments must be identical to those used in the initial model <a href="#specifying-the-model">specification</a>.</p>
<p><em>Note that the data frame passed to <code>get_predictions_from_df</code> need not be the data frame that was used in model fitting.</em> It can be a new data frame with missing outcome variables because they are not used in making predictions since the model has already been fit. However, this new data frame cannot have any missing values for random effects, fixed effects, or offsets. If it includes random effect grouping levels that were not observed in the fitting of the model, the random effect will be 0 for that level.</p>
<h2 id="easy-model-launching">Easy Model Launching</h2>
<p>To run a model with less code, you can use the following class that takes all of the same arguments
as <code>convert_df_to_model</code> (see <a href="#specifying-the-model">here</a>), <code>optimize_params</code> (see <a href="#fitting-the-model">here</a>)
with some exceptions:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">ccount.run</span> <span class="kn">import</span> <span class="n">ModelRun</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ModelRun</span><span class="p">(</span><span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">bootstraps</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>


<ul>
<li><code>training_df</code>: <code>(pd.DataFrame)</code> your dataset that you want to train the model on (previously called <code>df</code> in <code>convert_df_to_model</code>)</li>
<li><code>prediction_df</code>: <code>(pd.DataFrame)</code> your dataset that you want to make predictions for (previously called <code>df</code> in <code>get_predictions_from_df</code>)</li>
<li><strong>NEW</strong>: <code>bootstraps</code>: <code>(optional int)</code> number of data bootstraps to perform for uncertainty</li>
<li><code>**kwargs</code>: all arguments that were previously passed to <code>convert_df_to_model</code> and <code>optimize_params</code></li>
</ul>
<p>When you initialize the <code>ModelRun</code>, it will set up your main model and then each of the models that will
be used for the data bootstraps (see <a href="../methods/#data-bootstrap">here</a> for a description of the data bootstrap method).
To fit the model, use the function <code>ModelRun.run()</code>. If you are using the boostrap functionality,
you can fit the model for each bootstrapped dataset in parallel with multiprocessing pools
 by passing a number of pools to <code>run</code>, like</p>
<div class="codehilite"><pre><span></span><code><span class="err">model.run(pools=5)</span>
</code></pre></div>


<p>To make predictions, use the function <code>ModelRun.predict(alpha=0.05)</code>, where
<code>alpha</code> corresponds to a <code>1 - alpha</code> confidence level (e.g. 95% confidence interval). There is no need to pass
additional arguments to the <code>run()</code> and <code>predict()</code> functions because all information about the optimization and 
prediction data frame was passed in to the <code>ModelRun</code> <code>**kwargs**</code>.</p>
<h3 id="bootstrap-data">Bootstrap Data</h3>
<p>If you pass individual-record data, you can use the built-in bootstrap function for <code>ModelRun</code>.
However, if you have grouped data, you should use the helper function <code>ccount.processing.resample_data</code>
to resample your data based on the observed probability of having the outcome. The data
needs to be structured with some id columns, a size column representing the count,
and an outcome column of 1's and 0's corresponding to that count. The
<code>resample_data</code> function will return a list of data frames as long 
as the number of resamples you requested. An example is below.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ccount.processing</span> <span class="kn">import</span> <span class="n">resample_data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">repeats</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="s1">&#39;outcome&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">reps</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">data_frames</span> <span class="o">=</span> <span class="n">resample_data</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">outcome_col</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">id_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">size_col</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>


<p>You can then pass this new <code>data_frames</code> list of data frames to the <code>ModelRun</code> function
as the <code>boostrap_dfs</code> argument in the init.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../models/" title="Models" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Models
              </div>
            </div>
          </a>
        
        
          <a href="../updates/" title="Release Notes" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Release Notes
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.7f4f3c92.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9b3611bd.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>